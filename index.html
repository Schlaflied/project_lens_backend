<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÅåÂú∫ÈÄèÈïú (Project Lens) v22.1 - Clean Citation</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.8/dist/purify.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;500;700&display=swap');
        :root { 
            --background-color: #121212; --surface-color: #1e1e1e; --primary-color: #9b59b6; 
            --text-color: #e0e0e0; --text-secondary-color: #a0a0a0; --border-color: #333; 
            --card-padding: 30px; --success-color: #2ecc71; --warning-color: #f39c12; --danger-color: #e74c3c;
            --info-color: #3498db;
        }
        html.light-mode { 
            --background-color: #f4f5f7; --surface-color: #ffffff; --primary-color: #007bff; 
            --text-color: #333333; --text-secondary-color: #777777; --border-color: #e0e0e0; 
            --info-color: #007bff;
        }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', 'Noto Sans SC', 'Noto Sans TC', sans-serif; background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 20px; box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }
        .header { width: 100%; max-width: 1400px; margin: 0 auto 20px auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 700; }
        .controls { display: flex; align-items: center; gap: 15px; }
        .main-container { display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 1400px; margin: 0 auto; height: calc(100vh - 100px); }
        @media (min-width: 1024px) { .main-container { flex-direction: row; } }
        .panel { background-color: var(--surface-color); border-radius: 16px; border: 1px solid var(--border-color); padding: var(--card-padding); box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .input-panel, .output-panel { flex: 1; overflow-y: auto; }
        h1 { font-size: 28px; margin-top: 0; margin-bottom: 10px; }
        h2 { font-size: 20px; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px; margin-top: 25px; display: flex; align-items: center;}
        h3 { font-size: 18px; display: flex; align-items: center; margin-bottom: 10px; margin-top: 20px;}
        .report-header { text-align: center; margin-bottom: 20px; }
        .report-header .company-name { font-size: 24px; font-weight: bold; }
        .report-header .company-location { font-size: 16px; color: var(--text-secondary-color); margin-top: 4px; }
        .subtitle { color: var(--text-secondary-color); margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 500; margin-bottom: 8px; font-size: 14px; }
        textarea, input[type="text"] { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 15px; box-sizing: border-box; background-color: var(--background-color); color: var(--text-color); }
        textarea { resize: vertical; }
        .analyze-button { width: 100%; padding: 15px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s; display: flex; justify-content: center; align-items: center; margin-top: auto; }
        .analyze-button:disabled { background: #555; cursor: not-allowed; }
        #result-container { line-height: 1.7; }
        .tooltip-container { position: relative; display: inline-flex; margin-left: 8px; cursor: help; }
        .tooltip-icon { font-family: serif; font-size: 12px; width: 16px; height: 16px; border-radius: 50%; border: 1px solid var(--text-secondary-color); color: var(--text-secondary-color); align-items: center; justify-content: center; font-weight: bold; font-style: italic; display: inline-flex; }
        .tooltip-text { visibility: hidden; width: 250px; background-color: #2c2c2c; color: var(--text-color); text-align: left; border-radius: 8px; padding: 12px; position: absolute; z-index: 1; bottom: 140%; left: 50%; margin-left: -125px; opacity: 0; transition: opacity 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.25); border: 1px solid #444; font-size: 14px; line-height: 1.5; font-weight: normal; font-style: normal; }
        html.light-mode .tooltip-text { background-color: #f8f9fa; border: 1px solid var(--border-color); }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
        .report-section { padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid; transition: all 0.3s ease; }
        .report-section h2 { border-bottom: none; margin: 0 0 10px 0; padding-bottom: 0; }
        .report-section.success { border-color: var(--success-color); background-color: rgba(46, 204, 113, 0.08); }
        .report-section.success h2 { color: var(--success-color) !important; }
        .report-section.warning { border-color: var(--warning-color); background-color: rgba(243, 156, 18, 0.08); }
        .report-section.warning h2 { color: var(--warning-color) !important; }
        .report-section.info { border-color: var(--info-color); background-color: rgba(52, 152, 219, 0.08); }
        .report-section.info h2 { color: var(--info-color) !important; }
        .report-section .status { font-weight: bold; }
        .progress-bar-container { width: 100%; background-color: var(--border-color); border-radius: 10px; height: 20px; overflow: hidden; margin-top: 10px; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, rgba(155,89,182,1) 0%, rgba(142,68,173,1) 100%); border-radius: 10px; text-align: center; color: white; font-weight: bold; line-height: 20px; transition: width 0.5s ease-in-out; }
        html.light-mode .progress-bar { background: linear-gradient(90deg, rgba(0,123,255,1) 0%, rgba(0,110,235,1) 100%); }
        .citation-link { color: var(--primary-color); text-decoration: none; font-weight: bold; vertical-align: super; font-size: 0.8em; margin: 0 2px; }
        .citation-link:hover { text-decoration: underline; }
        .sources-container { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .source-item { display: flex; align-items: center; padding: 4px 0; font-size: 14px; color: var(--text-secondary-color); }
        .source-item a { color: var(--text-secondary-color); text-decoration: none; margin-left: 8px; }
        .source-item a:hover { text-decoration: underline; color: var(--text-color); }
        .source-icon { width: 16px; height: 16px; margin-right: 8px; flex-shrink: 0; color: var(--text-secondary-color); }
        .lang-toggle, .coffee-button, .theme-switcher { transition: all 0.2s ease-in-out; }
        .lang-toggle { display: flex; border: 1px solid var(--border-color); border-radius: 20px; overflow: hidden; background-color: var(--surface-color); }
        .lang-toggle button { background: none; border: none; color: var(--text-secondary-color); padding: 8px 16px; cursor: pointer; font-size: 15px; font-weight: 500; }
        .lang-toggle button:not(:last-child) { border-right: 1px solid var(--border-color); }
        .lang-toggle button:hover:not(.active), .lang-toggle button.active { background-color: var(--primary-color); color: white; }
        .coffee-button { display: flex; align-items: center; justify-content: center; gap: 8px; background-color: transparent; border: 1px solid var(--border-color); color: var(--text-secondary-color); padding: 8px 16px; border-radius: 20px; text-decoration: none; font-size: 15px; font-weight: 500; }
        .coffee-button:hover { color: var(--text-color); background-color: var(--surface-color); border-color: var(--text-color); }
        .theme-switcher { background: none; border: 1px solid var(--border-color); color: var(--text-secondary-color); cursor: pointer; font-size: 24px; padding: 5px; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .theme-switcher:hover { color: var(--text-color); background-color: var(--surface-color); }
        .spinner { border: 3px solid rgba(255,255,255,0.2); width: 18px; height: 18px; border-radius: 50%; border-left-color: #fff; animation: spin 1s ease infinite; display: inline-block; vertical-align: middle; margin-left: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .aspect-tags { display: flex; flex-wrap: wrap; gap: 10px; }
        .aspect-tags input[type="checkbox"] { display: none; }
        .aspect-tags label { display: inline-block; padding: 8px 16px; border: 1px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.2s ease-in-out; font-size: 14px; margin-bottom: 0; }
        .aspect-tags input[type="checkbox"]:checked + label { background-color: var(--primary-color); border-color: var(--primary-color); color: white; font-weight: bold; }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo" id="logo"></div>
        <div class="controls">
             <a href="https://buymeacoffee.com/200203sytty" target="_blank" rel="noopener noreferrer" class="coffee-button">
                <span>‚òïÔ∏è</span><span data-key="support_text"></span>
            </a>
            <button class="theme-switcher" id="theme-switcher">‚òÄÔ∏è</button>
            <div class="lang-toggle" id="lang-toggle">
                <button data-lang="zh-CN" class="active">ÁÆÄ</button>
                <button data-lang="zh-TW">ÁπÅ</button>
                <button data-lang="en">EN</button>
            </div>
        </div>
    </header>

    <main class="main-container">
        <section class="panel input-panel">
            <div>
                <h1 data-key="title"></h1>
                <p class="subtitle" data-key="subtitle"></p>
                <div class="form-group">
                    <label for="smart-paste-box" data-key="smart_paste_label"></label>
                    <textarea id="smart-paste-box" rows="5" data-key-placeholder="smart_paste_placeholder"></textarea>
                </div>
                <div class="form-group">
                    <label data-key="aspects_label"></label>
                    <div class="aspect-tags" id="aspect-tags">
                        <input type="checkbox" id="wlb" value="wlb" checked><label for="wlb" data-key="aspect_wlb"></label>
                        <input type="checkbox" id="reputation" value="reputation" checked><label for="reputation" data-key="aspect_reputation"></label>
                        <input type="checkbox" id="growth" value="growth" checked><label for="growth" data-key="aspect_growth"></label>
                        <input type="checkbox" id="innovation" value="innovation"><label for="innovation" data-key="aspect_innovation"></label>
                        <input type="checkbox" id="salary" value="salary" checked><label for="salary" data-key="aspect_salary"></label>
                        <input type="checkbox" id="benefits" value="benefits"><label for="benefits" data-key="aspect_benefits"></label>
                        <input type="checkbox" id="overtime" value="overtime" checked><label for="overtime" data-key="aspect_overtime"></label>
                        <input type="checkbox" id="management" value="management"><label for="management" data-key="aspect_management"></label>
                        <input type="checkbox" id="diversity" value="diversity"><label for="diversity" data-key="aspect_diversity"></label>
                        <input type="checkbox" id="training" value="training"><label for="training" data-key="aspect_training"></label>
                        <input type="checkbox" id="sustainability" value="sustainability"><label for="sustainability" data-key="aspect_sustainability"></label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="resume-text" data-key="resume_label"></label>
                    <textarea id="resume-text" rows="4" data-key-placeholder="resume_placeholder"></textarea>
                </div>
            </div>
            <button class="analyze-button" id="analyze-button"><span data-key="button_text"></span></button>
        </section>

        <section class="panel output-panel">
            <div id="result-container">
                <div class="welcome-message">
                    <h2 data-key="welcome_title"></h2>
                    <p data-key="welcome_p1" style="color: var(--text-secondary-color); margin-top: 15px;"></p>
                </div>
            </div>
            <div class="sources-container" id="sources-container"></div>
        </section>
    </main>

    <script>
        // --- 1. ÂÖÉÁ¥†Ëé∑Âèñ ---
        const smartPasteBox = document.getElementById('smart-paste-box');
        const resumeTextInput = document.getElementById('resume-text');
        const analyzeButton = document.getElementById('analyze-button');
        const resultContainer = document.getElementById('result-container');
        const sourcesContainer = document.getElementById('sources-container');
        const themeSwitcher = document.getElementById('theme-switcher');
        const langToggle = document.getElementById('lang-toggle');
        const logo = document.getElementById('logo');
        const aspectTagsContainer = document.getElementById('aspect-tags');

        // --- 2. API ÈÖçÁΩÆ ---
        const API_URL = 'https://project-lens-backend-885033581194.us-central1.run.app/analyze'; 

        // --- 3. ÂÖ®Â±ÄÁä∂ÊÄÅÂèòÈáè ---
        let fullReportData = null; 
        let companyNameData = null;
        let sourcesData = null;

        // --- 4. ÂõæÊ†áÂÆö‰πâ (Êó†ÂèòÂåñ) ---
        const ICONS = {
            linkedin: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/></svg>`,
            glassdoor: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.185 1.185A1.5 1.5 0 0 1 2.57.293l10.854 10.854a.5.5 0 0 1 0 .708L11.146 14a.5.5 0 0 1-.708 0L.293 2.854A1.5 1.5 0 0 1 1.185 1.185zM14.815 1.185a1.5 1.5 0 0 0-2.122 0L.854 13.146a.5.5 0 0 0 0 .708L2.854 15.707a.5.5 0 0 0 .708 0L15.707 3.565a1.5 1.5 0 0 0 0-2.122l-.892-.892z"/></svg>`,
            indeed: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M13.555 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM10.31 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM8.36 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM5.945 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM15.363 4.091A1.91 1.91 0 0 0 13.455 2.182h-10.91A1.91 1.91 0 0 0 .636 4.091v7.818A1.91 1.91 0 0 0 2.545 13.818h10.91a1.91 1.91 0 0 0 1.909-1.909V4.091zM2.909 5.227a1.136 1.136 0 1 1 0 2.273 1.136 1.136 0 0 1 0-2.273z"/></svg>`,
            default: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/></svg>`
        };

        // --- 5. ÂõΩÈôÖÂåñ (i18n) ---
        let currentLang = 'zh-CN';
        const translations = {
            'zh-CN': { 
                logo_text: 'üî¨ ËÅåÂú∫ÈÄèÈïú', title: 'ËæìÂÖ•‰ø°ÊÅØ', subtitle: 'AIÂ∞ÜËá™Âä®ÊêúÁ¥¢Âπ∂ÂàÜÊûêÂÖ¨Âè∏',
                smart_paste_label: 'Á≤òË¥¥ËÅå‰Ωç‰ø°ÊÅØÊàñÂÖ¨Âè∏Âêç', smart_paste_placeholder: 'Âú®Ê≠§Â§ÑÁ≤òË¥¥ËÅå‰ΩçÊèèËø∞(JD)ÊàñÂÖ¨Âè∏Âêç...',
                aspects_label: 'ÈÄâÊã©‰Ω†ÂÖ≥Ê≥®ÁöÑÊñπÈù¢ (ÂàÜÊûêÂêéÂèØÈöèÊó∂ÂàáÊç¢)',
                aspect_wlb: 'Â∑•‰Ωú‰∏éÁîüÊ¥ªÂπ≥Ë°°', aspect_reputation: 'ÂÖ¨Âè∏Â£∞Ë™â', aspect_growth: 'ÊàêÈïøÊú∫‰ºö',
                aspect_innovation: 'ÂàõÊñ∞ÊñáÂåñ', aspect_salary: 'Ëñ™ÈÖ¨Ê∞¥Âπ≥', aspect_benefits: 'Á¶èÂà©ÂæÖÈÅá',
                aspect_overtime: 'Âä†Áè≠ÊñáÂåñ', aspect_management: 'ÁÆ°ÁêÜÈ£éÊ†º', aspect_diversity: 'Â§öÂÖÉÂåñ‰∏éÂåÖÂÆπÊÄß',
                aspect_training: 'ÂüπËÆ≠‰∏éÂ≠¶‰π†', aspect_sustainability: 'ÂèØÊåÅÁª≠ÊÄß',
                resume_label: 'ÊàëÁöÑÁÆÄÂéÜ / ‰∏™‰∫∫ÁÆÄ‰ªã (ÂèØÈÄâ)', resume_placeholder: 'Á≤òË¥¥‰Ω†ÁöÑ‰∏™‰∫∫ÁÆÄ‰ªãÊàñÁÆÄÂéÜÔºåËé∑ÂæóÊõ¥Á≤æÂáÜÁöÑÂåπÈÖçÂàÜÊûê...',
                button_text: 'ÂºÄÂßãÂàÜÊûê', button_loading_text: 'ÂàÜÊûê‰∏≠...',
                support_text: "ËØ∑ÂºÄÂèëËÄÖÂñùÊùØÂíñÂï°",
                welcome_title: "Ê¨¢ËøéÊù•Âà∞ Project LensÔºÅ", welcome_p1: "ÊàëËÉΩÂ∏Æ‰Ω†‰∏ÄÈîÆÂàÜÊûêÂÖ¨Âè∏ÊñáÂåñÔºåÈÅøÂÖçÊ±ÇËÅåË∏©Âùë„ÄÇËØ∑Âú®Â∑¶‰æßËæìÂÖ•‰ø°ÊÅØÔºåÂºÄÂßã‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°Êé¢Á¥¢ÂêßÔºÅ",
                no_info_found: "Êä±Ê≠âÔºåÊàëÂú®ÁΩëÁªú‰∏äÊâæ‰∏çÂà∞ÂÖ≥‰∫éËøôÂÆ∂ÂÖ¨Âè∏ÁöÑÊúâÊïà‰ø°ÊÅØ„ÄÇËØ∑Â∞ùËØï‰ΩøÁî®ÂÖ¨Âè∏ÁöÑÂÆòÊñπÂÖ®Áß∞ÂÜçËØï‰∏ÄÊ¨°„ÄÇ",
                connection_error: "ÂèëÁîüËøûÊé•ÈîôËØØÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñËÅîÁ≥ªÂºÄÂèëËÄÖ„ÄÇ",
                generic_error: "ÂèëÁîü‰∫Ü‰∏Ä‰∏™ÈîôËØØ„ÄÇËØ∑Á®çÂêéÈáçËØïÊàñËÅîÁ≥ªÂºÄÂèëËÄÖ„ÄÇ",
                rate_limit_exceeded: "ÂºÄÊãìËÄÖÔºå‰Ω†Â∑≤ÁªèÁî®ÂÆå‰∫Ü‰ªäÊó•ÁöÑÈ¢ùÂ∫¶„ÄÇüöÄ Project LensÊØèÂ§©‰∏∫Áî®Êà∑Êèê‰æõ‰∫îÊ¨°ÂÖçË¥πÂÖ¨Âè∏Êü•ËØ¢ÔºåÂ¶ÇÊûú‰Ω†ÊòØÈáçÂ∫¶Áî®Êà∑ÔºåÈÄöËøáËÆ¢ÈòÖProÔºàComing SoonÔºâÊàñËÄÖËØ∑ÊàëÂñùÊùØÂíñÂï°‚òïÔ∏èÊù•ÈáçÁΩÆÊü•ËØ¢Ê¨°Êï∞„ÄÇ",
                loading_statuses: ["Ê≠£Âú®ËøûÊé•AIÂ§ßËÑë...", "Ê≠£Âú®ÂÖ®ÁΩëÊêúÁ¥¢ÂÖ¨Âè∏‰ø°ÊÅØ...", "Ê≠£Âú®ÈòÖËØªÁõ∏ÂÖ≥Êñ∞Èóª‰∏éËØÑ‰ª∑...", "Ê≠£Âú®Âè¨Âî§ Gemini ËøõË°åÊ∑±Â∫¶ÂàÜÊûê...", "Âç≥Â∞ÜÂÆåÊàêÔºåÊ≠£Âú®ÁîüÊàêÊä•Âëä..."],
                report_titles: {
                    red_flag: 'üö® Red Flag È£éÈô©Êâ´Êèè', culture_fit: 'üìä ÊñáÂåñÂ•ëÂêàÂ∫¶ÂàÜÊûê', hiring_experience: 'üëª ÊãõËÅòÊµÅÁ®ã‰∏éÂÄôÈÄâ‰∫∫‰ΩìÈ™åÂàÜÊûê',
                    timeliness: '‚è±Ô∏è ‰ø°ÊÅØÊó∂ÊïàÊÄßÂàÜÊûê', value_match: 'üíñ ‰ª∑ÂÄºÂåπÈÖçÊä•Âëä', final_risk: '‚öñÔ∏è ÊúÄÁªàÈ£éÈô©ËØÑ‰º∞', sources: 'ÂºïÁî®Êù•Ê∫ê'
                },
                aspects: {
                    reputation: 'ÂÖ¨Âè∏Â£∞Ë™â', management: 'ÁÆ°ÁêÜÈ£éÊ†º', sustainability: 'ÂèØÊåÅÁª≠ÊÄß', wlb: 'Â∑•‰Ωú‰∏éÁîüÊ¥ªÂπ≥Ë°°',
                    growth: 'ÊàêÈïøÊú∫‰ºö', salary: 'Ëñ™ÈÖ¨Ê∞¥Âπ≥', overtime: 'Âä†Áè≠ÊñáÂåñ', innovation: 'ÂàõÊñ∞ÊñáÂåñ',
                    benefits: 'Á¶èÂà©ÂæÖÈÅá', diversity: 'Â§öÂÖÉÂåñ‰∏éÂåÖÂÆπÊÄß', training: 'ÂüπËÆ≠‰∏éÂ≠¶‰π†', rating: 'ËØÑÁ∫ß'
                },
                definitions: {
                    reputation: 'ÂÖ¨Âè∏Â£∞Ë™âÊòØÂÖ¨‰ºó„ÄÅÂÆ¢Êà∑„ÄÅÂëòÂ∑•ÂíåÊäïËµÑËÄÖÂØπ‰∏Ä‰∏™ÁªÑÁªáÁöÑÁªºÂêàÁúãÊ≥ïÂíåËØÑ‰ª∑„ÄÇ',
                    management: 'ÁÆ°ÁêÜÈ£éÊ†ºÊòØÊåáÂÖ¨Âè∏ÂêÑÁ∫ßÁÆ°ÁêÜËÄÖÂú®È¢ÜÂØºÂõ¢Èòü„ÄÅÂàÜÈÖç‰ªªÂä°„ÄÅÂÅöÂá∫ÂÜ≥Á≠ñÊó∂ÊâÄË°®Áé∞Âá∫ÁöÑ‰∏ÄË¥ØË°å‰∏∫Ê®°Âºè„ÄÇ',
                    sustainability: 'ÂèØÊåÅÁª≠ÊÄßÊòØÊåáÂÖ¨Âè∏Âú®ËøΩÊ±ÇÁªèÊµéÂà©ÁõäÁöÑÂêåÊó∂ÔºåÂ¶Ç‰ΩïÂπ≥Ë°°ÂÖ∂ÂØπÁ§æ‰ºöÂíåÁéØÂ¢ÉÁöÑÂΩ±Âìç„ÄÇ',
                    wlb: 'Â∑•‰Ωú‰∏éÁîüÊ¥ªÂπ≥Ë°°ÊåáÁöÑÊòØÂëòÂ∑•ËÉΩÂ§üÂú®ËÅå‰∏öË¥£‰ªªÂíå‰∏™‰∫∫ÁîüÊ¥ª‰πãÈó¥ÊâæÂà∞‰∏Ä‰∏™ÂÅ•Â∫∑ÁöÑÂπ≥Ë°°ÁÇπ„ÄÇ',
                    growth: 'ÊàêÈïøÊú∫‰ºöÊåáÁöÑÊòØÂÖ¨Âè∏‰∏∫ÂëòÂ∑•Êèê‰æõÁöÑÂ≠¶‰π†Êñ∞ÊäÄËÉΩ„ÄÅÊâøÊãÖÊõ¥Â§öË¥£‰ªª„ÄÅ‰ª•ÂèäËé∑ÂæóÊôâÂçáÁöÑÂèØËÉΩÊÄß„ÄÇ',
                    salary: 'Ëñ™ÈÖ¨Ê∞¥Âπ≥ÊåáÁöÑÊòØÂÖ¨Âè∏Êèê‰æõÁöÑÂ∑•ËµÑ„ÄÅÂ•ñÈáëÁ≠âÁé∞ÈáëÊä•ÈÖ¨Âú®Â∏ÇÂú∫‰∏≠ÁöÑÁõ∏ÂØπ‰ΩçÁΩÆ„ÄÇ',
                    overtime: 'Âä†Áè≠ÊñáÂåñÊòØÊåáÂÖ¨Âè∏ÂØπ‰∫éÊ≠£Â∏∏Â∑•‰ΩúÊó∂Èó¥‰πãÂ§ñÁöÑÈ¢ùÂ§ñÂ∑•‰ΩúÁöÑÊôÆÈÅçÊÄÅÂ∫¶ÂíåÂÅöÊ≥ï„ÄÇ',
                    innovation: 'ÂàõÊñ∞ÊñáÂåñÊòØÊåáÂÖ¨Âè∏ÈºìÂä±ÂíåÊîØÊåÅÂëòÂ∑•ÊèêÂá∫Êñ∞ÊÉ≥Ê≥ï„ÄÅÂ∞ùËØïÊñ∞ÊñπÊ≥ïÂπ∂‰ªéÂ§±Ë¥•‰∏≠Â≠¶‰π†ÁöÑÂÜÖÈÉ®ÁéØÂ¢É„ÄÇ',
                    benefits: 'Á¶èÂà©ÂæÖÈÅáÊòØÊåáÂÖ¨Âè∏Âú®Â∑•ËµÑ‰πãÂ§ñ‰∏∫ÂëòÂ∑•Êèê‰æõÁöÑÈùûÁé∞ÈáëÂΩ¢ÂºèÁöÑÊä•ÈÖ¨ÔºåÂ¶ÇÂÅ•Â∫∑‰øùÈô©„ÄÅÈÄÄ‰ºëÈáëËÆ°Âàí„ÄÅÂ∏¶Ëñ™‰ºëÂÅáÁ≠â„ÄÇ',
                    diversity: 'Â§öÂÖÉÂåñ‰∏éÂåÖÂÆπÊÄßÊòØÊåáÂÖ¨Âè∏Âú®ÂëòÂ∑•ÊûÑÊàê‰∏ä‰ΩìÁé∞Â§öÊ†∑ÊÄßÔºåÂπ∂ÂàõÈÄ†‰∏Ä‰∏™ËÆ©ÊâÄÊúâËÉåÊôØÁöÑÂëòÂ∑•ÈÉΩÊÑüÂà∞Ë¢´Â∞äÈáçÂíåÈáçËßÜÁöÑÂ∑•‰ΩúÁéØÂ¢É„ÄÇ',
                    training: 'ÂüπËÆ≠‰∏éÂ≠¶‰π†ÊåáÁöÑÊòØÂÖ¨Âè∏‰∏∫ÊèêÂçáÂëòÂ∑•ÊäÄËÉΩÂíåÁü•ËØÜËÄåÊèê‰æõÁöÑÂêÑÁßçÊ≠£ÂºèÂíåÈùûÊ≠£ÂºèÁöÑÂ≠¶‰π†Êú∫‰ºö„ÄÇ',
                }
            },
             'zh-TW': {
                logo_text: 'üî¨ ËÅ∑Â†¥ÈÄèÈè°', title: 'Ëº∏ÂÖ•Ë≥áË®ä', subtitle: 'AIÂ∞áËá™ÂãïÊêúÁ¥¢‰∏¶ÂàÜÊûêÂÖ¨Âè∏',
                smart_paste_label: 'Ë≤º‰∏äËÅ∑‰ΩçË≥áË®äÊàñÂÖ¨Âè∏Âêç', smart_paste_placeholder: 'Âú®Ê≠§ËôïË≤º‰∏äËÅ∑‰ΩçÊèèËø∞(JD)ÊàñÂÖ¨Âè∏Âêç...',
                aspects_label: 'ÈÅ∏ÊìáÊÇ®ÈóúÊ≥®ÁöÑÊñπÈù¢ (ÂàÜÊûêÂæåÂèØÈö®ÊôÇÂàáÊèõ)',
                aspect_wlb: 'Â∑•‰ΩúËàáÁîüÊ¥ªÂπ≥Ë°°', aspect_reputation: 'ÂÖ¨Âè∏ËÅ≤Ë≠Ω', aspect_growth: 'ÊàêÈï∑Ê©üÊúÉ',
                aspect_innovation: 'ÂâµÊñ∞ÊñáÂåñ', aspect_salary: 'Ëñ™ÈÖ¨Ê∞¥Âπ≥', aspect_benefits: 'Á¶èÂà©ÂæÖÈÅá',
                aspect_overtime: 'Âä†Áè≠ÊñáÂåñ', aspect_management: 'ÁÆ°ÁêÜÈ¢®Ê†º', aspect_diversity: 'Â§öÂÖÉÂåñËàáÂåÖÂÆπÊÄß',
                aspect_training: 'ÂüπË®ìËàáÂ≠∏Áøí', aspect_sustainability: 'Ê∞∏Á∫åÊÄß',
                resume_label: 'ÊàëÁöÑÂ±•Ê≠∑ / ÂÄã‰∫∫Á∞°‰ªã (ÂèØÈÅ∏)', resume_placeholder: 'Ë≤º‰∏ä‰Ω†ÁöÑÂÄã‰∫∫Á∞°‰ªãÊàñÂ±•Ê≠∑ÔºåÁç≤ÂæóÊõ¥Á≤æÊ∫ñÁöÑÂåπÈÖçÂàÜÊûê...',
                button_text: 'ÈñãÂßãÂàÜÊûê', button_loading_text: 'ÂàÜÊûê‰∏≠...',
                support_text: "Ë´ãÈñãÁôºËÄÖÂñùÊùØÂíñÂï°",
                welcome_title: "Ê≠°Ëøé‰æÜÂà∞ Project LensÔºÅ", welcome_p1: "ÊàëËÉΩÂπ´‰Ω†‰∏ÄÈçµÂàÜÊûêÂÖ¨Âè∏ÊñáÂåñÔºåÈÅøÂÖçÊ±ÇËÅ∑Ë∏©Âùë„ÄÇË´ãÂú®Â∑¶ÂÅ¥Ëº∏ÂÖ•Ë≥áË®äÔºåÈñãÂßã‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°Êé¢Á¥¢ÂêßÔºÅ",
                no_info_found: "Êä±Ê≠âÔºåÊàëÂú®Á∂≤Ë∑Ø‰∏äÊâæ‰∏çÂà∞ÈóúÊñºÈÄôÂÆ∂ÂÖ¨Âè∏ÁöÑÊúâÊïàË≥áË®ä„ÄÇË´ãÂòóË©¶‰ΩøÁî®ÂÖ¨Âè∏ÁöÑÂÆòÊñπÂÖ®ÂêçÂÜçË©¶‰∏ÄÊ¨°„ÄÇ",
                connection_error: "ÁôºÁîüÈÄ£Êé•ÈåØË™§ÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÊàñËÅØÁµ°ÈñãÁôºËÄÖ„ÄÇ",
                generic_error: "ÁôºÁîü‰∫Ü‰∏ÄÂÄãÈåØË™§„ÄÇË´ãÁ®çÂæåÈáçË©¶ÊàñËÅØÁµ°ÈñãÁôºËÄÖ„ÄÇ",
                rate_limit_exceeded: "ÈñãÊãìËÄÖÔºå‰Ω†Â∑≤Á∂ìÁî®ÂÆå‰∫Ü‰ªäÊó•ÁöÑÈ°çÂ∫¶„ÄÇüöÄ Project LensÊØèÂ§©ÁÇ∫Áî®Êà∂Êèê‰æõ‰∫îÊ¨°ÂÖçË≤ªÂÖ¨Âè∏Êü•Ë©¢ÔºåÂ¶ÇÊûú‰Ω†ÊòØÈáçÂ∫¶Áî®Êà∂ÔºåÈÄöÈÅéË®ÇÈñ±ProÔºàComing SoonÔºâÊàñËÄÖË´ãÊàëÂñùÊùØÂíñÂï°‚òïÔ∏è‰æÜÈáçÁΩÆÊü•Ë©¢Ê¨°Êï∏„ÄÇ",
                loading_statuses: ["Ê≠£Âú®ÈÄ£Êé•AIÂ§ßËÖ¶...", "Ê≠£Âú®ÂÖ®Á∂≤ÊêúÂ∞ãÂÖ¨Âè∏Ë≥áË®ä...", "Ê≠£Âú®Èñ±ËÆÄÁõ∏ÈóúÊñ∞ËÅûËàáË©ïÂÉπ...", "Ê≠£Âú®Âè¨Âñö Gemini ÈÄ≤Ë°åÊ∑±Â∫¶ÂàÜÊûê...", "Âç≥Â∞áÂÆåÊàêÔºåÊ≠£Âú®ÁîüÊàêÂ†±Âëä..."],
                report_titles: {
                    red_flag: 'üö® Red Flag È¢®Èö™ÊéÉÊèè', culture_fit: 'üìä ÊñáÂåñÂ•ëÂêàÂ∫¶ÂàÜÊûê', hiring_experience: 'üëª ÊãõËÅòÊµÅÁ®ãËàáÂÄôÈÅ∏‰∫∫È´îÈ©óÂàÜÊûê',
                    timeliness: '‚è±Ô∏è Ë≥áË®äÊôÇÊïàÊÄßÂàÜÊûê', value_match: 'üíñ ÂÉπÂÄºÂåπÈÖçÂ†±Âëä', final_risk: '‚öñÔ∏è ÊúÄÁµÇÈ¢®Èö™Ë©ï‰º∞', sources: 'ÂºïÁî®‰æÜÊ∫ê'
                },
                aspects: {
                    reputation: 'ÂÖ¨Âè∏ËÅ≤Ë≠Ω', management: 'ÁÆ°ÁêÜÈ¢®Ê†º', sustainability: 'Ê∞∏Á∫åÊÄß', wlb: 'Â∑•‰ΩúËàáÁîüÊ¥ªÂπ≥Ë°°',
                    growth: 'ÊàêÈï∑Ê©üÊúÉ', salary: 'Ëñ™ÈÖ¨Ê∞¥Âπ≥', overtime: 'Âä†Áè≠ÊñáÂåñ', innovation: 'ÂâµÊñ∞ÊñáÂåñ',
                    benefits: 'Á¶èÂà©ÂæÖÈÅá', diversity: 'Â§öÂÖÉÂåñËàáÂåÖÂÆπÊÄß', training: 'ÂüπË®ìËàáÂ≠∏Áøí', rating: 'Ë©ïÁ¥ö'
                },
                definitions: {
                    reputation: 'ÂÖ¨Âè∏ËÅ≤Ë≠ΩÊòØÂÖ¨Áúæ„ÄÅÂÆ¢Êà∂„ÄÅÂì°Â∑•ÂíåÊäïË≥áËÄÖÂ∞ç‰∏ÄÂÄãÁµÑÁπîÁöÑÁ∂úÂêàÁúãÊ≥ïÂíåË©ïÂÉπ„ÄÇ',
                    management: 'ÁÆ°ÁêÜÈ¢®Ê†ºÊòØÊåáÂÖ¨Âè∏ÂêÑÁ¥öÁÆ°ÁêÜËÄÖÂú®È†òÂ∞éÂúòÈöä„ÄÅÂàÜÈÖç‰ªªÂãô„ÄÅÂÅöÂá∫Ê±∫Á≠ñÊôÇÊâÄË°®ÁèæÂá∫ÁöÑ‰∏ÄË≤´Ë°åÁÇ∫Ê®°Âºè„ÄÇ',
                    sustainability: 'Ê∞∏Á∫åÊÄßÊòØÊåáÂÖ¨Âè∏Âú®ËøΩÊ±ÇÁ∂ìÊøüÂà©ÁõäÁöÑÂêåÊôÇÔºåÂ¶Ç‰ΩïÂπ≥Ë°°ÂÖ∂Â∞çÁ§æÊúÉÂíåÁí∞Â¢ÉÁöÑÂΩ±Èüø„ÄÇ',
                    wlb: 'Â∑•‰ΩúËàáÁîüÊ¥ªÂπ≥Ë°°ÊåáÁöÑÊòØÂì°Â∑•ËÉΩÂ§†Âú®ËÅ∑Ê•≠Ë≤¨‰ªªÂíåÂÄã‰∫∫ÁîüÊ¥ª‰πãÈñìÊâæÂà∞‰∏ÄÂÄãÂÅ•Â∫∑ÁöÑÂπ≥Ë°°Èªû„ÄÇ',
                    growth: 'ÊàêÈï∑Ê©üÊúÉÊåáÁöÑÊòØÂÖ¨Âè∏ÁÇ∫Âì°Â∑•Êèê‰æõÁöÑÂ≠∏ÁøíÊñ∞ÊäÄËÉΩ„ÄÅÊâøÊìîÊõ¥Â§öË≤¨‰ªª„ÄÅ‰ª•ÂèäÁç≤ÂæóÊôâÂçáÁöÑÂèØËÉΩÊÄß„ÄÇ',
                    salary: 'Ëñ™ÈÖ¨Ê∞¥Âπ≥ÊåáÁöÑÊòØÂÖ¨Âè∏Êèê‰æõÁöÑÂ∑•Ë≥á„ÄÅÁçéÈáëÁ≠âÁèæÈáëÂ†±ÈÖ¨Âú®Â∏ÇÂ†¥‰∏≠ÁöÑÁõ∏Â∞ç‰ΩçÁΩÆ„ÄÇ',
                    overtime: 'Âä†Áè≠ÊñáÂåñÊòØÊåáÂÖ¨Âè∏Â∞çÊñºÊ≠£Â∏∏Â∑•‰ΩúÊôÇÈñì‰πãÂ§ñÁöÑÈ°çÂ§ñÂ∑•‰ΩúÁöÑÊôÆÈÅçÊÖãÂ∫¶ÂíåÂÅöÊ≥ï„ÄÇ',
                    innovation: 'ÂâµÊñ∞ÊñáÂåñÊòØÊåáÂÖ¨Âè∏ÈºìÂãµÂíåÊîØÊåÅÂì°Â∑•ÊèêÂá∫Êñ∞ÊÉ≥Ê≥ï„ÄÅÂòóË©¶Êñ∞ÊñπÊ≥ï‰∏¶ÂæûÂ§±Êïó‰∏≠Â≠∏ÁøíÁöÑÂÖßÈÉ®Áí∞Â¢É„ÄÇ',
                    benefits: 'Á¶èÂà©ÂæÖÈÅáÊòØÊåáÂÖ¨Âè∏Âú®Â∑•Ë≥á‰πãÂ§ñÁÇ∫Âì°Â∑•Êèê‰æõÁöÑÈùûÁèæÈáëÂΩ¢ÂºèÁöÑÂ†±ÈÖ¨ÔºåÂ¶ÇÂÅ•Â∫∑‰øùÈö™„ÄÅÈÄÄ‰ºëÈáëË®àÁï´„ÄÅÂ∏∂Ëñ™‰ºëÂÅáÁ≠â„ÄÇ',
                    diversity: 'Â§öÂÖÉÂåñËàáÂåÖÂÆπÊÄßÊòØÊåáÂÖ¨Âè∏Âú®Âì°Â∑•ÊßãÊàê‰∏äÈ´îÁèæÂ§öÊ®£ÊÄßÔºå‰∏¶ÂâµÈÄ†‰∏ÄÂÄãËÆìÊâÄÊúâËÉåÊôØÁöÑÂì°Â∑•ÈÉΩÊÑüÂà∞Ë¢´Â∞äÈáçÂíåÈáçË¶ñÁöÑÂ∑•‰ΩúÁí∞Â¢É„ÄÇ',
                    training: 'ÂüπË®ìËàáÂ≠∏ÁøíÊåáÁöÑÊòØÂÖ¨Âè∏ÁÇ∫ÊèêÂçáÂì°Â∑•ÊäÄËÉΩÂíåÁü•Ë≠òËÄåÊèê‰æõÁöÑÂêÑÁ®ÆÊ≠£ÂºèÂíåÈùûÊ≠£ÂºèÁöÑÂ≠∏ÁøíÊ©üÊúÉ„ÄÇ',
                }
            },
            'en': {
                logo_text: 'üî¨ Project Lens', title: 'Input Information', subtitle: 'AI will automatically search and analyze the company',
                smart_paste_label: 'Paste Job Info or Company Name', smart_paste_placeholder: 'Paste job description (JD) or company name here...',
                aspects_label: 'Select Aspects You Care About (Switch anytime after analysis)',
                aspect_wlb: 'Work-Life Balance', aspect_reputation: 'Reputation', aspect_growth: 'Growth Opportunities',
                aspect_innovation: 'Innovation Culture', aspect_salary: 'Salary Level', aspect_benefits: 'Benefits Package',
                aspect_overtime: 'Overtime Culture', aspect_management: 'Management', aspect_diversity: 'Diversity & Inclusion',
                aspect_training: 'Training & Learning', aspect_sustainability: 'Sustainability',
                resume_label: 'My Resume / Bio (Optional)', resume_placeholder: 'Paste your bio or resume for a more accurate culture-fit analysis...',
                button_text: 'Analyze', button_loading_text: 'Analyzing...',
                support_text: "Buy me a coffee",
                welcome_title: "Welcome to Project Lens!", welcome_p1: "I can help you analyze company culture with one click to avoid job-hunting pitfalls. Please enter the info on the left to start your first exploration!",
                no_info_found: "Sorry, I couldn't find any valid information about this company online. Please try again using the company's official full name.",
                connection_error: "Connection error. Please check your network or contact the developer.",
                generic_error: "An error occurred. Please try again later or contact the developer.",
                rate_limit_exceeded: "Explorer, you have used up your free analysis quota for today. üöÄ Project Lens provides five free company analyses per day. If you're a heavy user, you can reset your query count by subscribing to Pro (Coming Soon) or by buying me a coffee ‚òïÔ∏è.",
                loading_statuses: ["Connecting to the AI brain...", "Searching for company info across the web...", "Reading related news and reviews...", "Summoning Gemini for deep analysis...", "Finalizing, generating report..."],
                report_titles: {
                    red_flag: 'üö® Red Flag Scan', culture_fit: 'üìä Culture Fit Analysis', hiring_experience: 'üëª Hiring Process & Candidate Experience Analysis',
                    timeliness: '‚è±Ô∏è Information Timeliness Analysis', value_match: 'üíñ Value Match Report', final_risk: '‚öñÔ∏è Final Risk Assessment', sources: 'References'
                },
                aspects: {
                    reputation: 'Reputation', management: 'Management', sustainability: 'Sustainability', wlb: 'Work-Life Balance',
                    growth: 'Growth Opportunities', salary: 'Salary Level', overtime: 'Overtime Culture', innovation: 'Innovation Culture',
                    benefits: 'Benefits Package', diversity: 'Diversity & Inclusion', training: 'Training & Learning', rating: 'Rating'
                },
                 definitions: {
                    reputation: 'Corporate reputation is the comprehensive perception and evaluation of an organization by the public, customers, employees, and investors.',
                    management: 'Management style refers to the consistent pattern of behavior exhibited by managers in leading teams, assigning tasks, and making decisions.',
                    sustainability: 'Sustainability refers to how a company balances its environmental and social impacts with its economic interests.',
                    wlb: 'Work-life balance refers to the healthy, sustainable equilibrium employees can find between their professional responsibilities and personal life.',
                    growth: 'Growth opportunities refer to the possibilities the company provides for employees to learn new skills, take on more responsibilities, and advance in their careers.',
                    salary: 'Salary level refers to the relative position of the cash compensation offered by the company within the market.',
                    overtime: 'Overtime culture refers to the company\'s general attitude and practices regarding extra work beyond normal working hours.',
                    innovation: 'Innovation culture refers to the internal environment where the company encourages and supports employees to propose new ideas, try new methods, and learn from failures.',
                    benefits: 'Benefits package refers to non-cash compensation provided to employees in addition to their wages, such as health insurance, retirement plans, paid time off, etc.',
                    diversity: 'Diversity and Inclusion refers to having a diverse workforce and creating a work environment where employees from all backgrounds feel respected and valued.',
                    training: 'Training and Learning refers to the various formal and informal learning opportunities provided by the company to enhance employee skills and knowledge.',
                }
            }
        };

        // --- 6. Ê†∏ÂøÉÂáΩÊï∞ [Â∑≤‰øÆÂ§ç] ---
        function setLanguage(langCode) {
            currentLang = langCode; document.documentElement.lang = langCode;
            const t = translations[currentLang];
            document.querySelectorAll('[data-key]').forEach(el=>el.textContent = t[el.dataset.key]||'');
            document.querySelectorAll('[data-key-placeholder]').forEach(el=>el.placeholder=t[el.dataset.keyPlaceholder]||'');
            logo.textContent = t.logo_text;
            langToggle.querySelectorAll('button').forEach(btn=>btn.classList.toggle('active', btn.dataset.lang===langCode));
        }

        function setTheme(theme) {
            document.documentElement.classList.toggle('light-mode', theme === 'light');
            themeSwitcher.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('theme', theme);
        }

        function renderReport() {
            if (!fullReportData) return;

            const t = translations[currentLang];
            const titles = t.report_titles;
            const aspects = t.aspects;
            const defs = t.definitions;

            // [Ê†∏ÂøÉ‰øÆÊîπ] Ê∏≤ÊüìÊä•ÂëäÊñáÊú¨ÁöÑÂ§ÑÁêÜÂáΩÊï∞
            const processText = text => {
                if (!text) return '';
                // 1. [Â∑≤‰øÆÂ§ç] Ê≠§Â§Ñ‰∏çÂÜçÈúÄË¶ÅÊâãÂä®Ê∏ÖÁêÜÔºåÁõ¥Êé•‰∫§Áªô marked.js Â§ÑÁêÜ

                // 2. ‰ΩøÁî® marked.js Â∞Ü [ID](#source-ID) Ê≠£Â∏∏Ê∏≤Êüì‰∏∫ÈìæÊé•
                const rawHtml = marked.parse(text, { breaks: true });

                return rawHtml.replace(/<a href=['\"]#source-(\\d+)['\"]>(\\d+)<\/a>/g, (match, sourceId, linkText) => {
                    const source = sourcesData.find(s => s.id == sourceId);
                    if (source && source.link) {
                        // Create an external link
                        return `<a href="${source.link}" class="citation-link" target="_blank" rel="noopener noreferrer">[${linkText}]</a>`;
                    } else {
                        // If source not found, display as plain text
                        return `[${linkText}]`;
                    }
                });
            };
            
            const selectedAspects = Array.from(aspectTagsContainer.querySelectorAll('input:checked')).map(input => input.value);
            
            const reportHeaderHTML = `<div class="report-header"><div class="company-name">${companyNameData}</div><div class="company-location">${fullReportData.company_location || ''}</div></div>`;

            const redFlagHTML = fullReportData.red_flag_text ? `<div class="report-section success"><h2>${titles.red_flag}</h2><div class="status">${processText(fullReportData.red_flag_status)}</div>${processText(fullReportData.red_flag_text)}</div>` : '';
            const hiringExperienceHTML = fullReportData.hiring_experience_text ? `<div class="report-section warning"><h2>${titles.hiring_experience}</h2>${processText(fullReportData.hiring_experience_text)}</div>` : '';
            const timelinessHTML = fullReportData.timeliness_analysis ? `<div class="report-section info"><h2>${titles.timeliness}</h2>${processText(fullReportData.timeliness_analysis)}</div>` : '';

            let cultureFitHTML = `<h2>${titles.culture_fit}</h2>`;
            const cf = fullReportData.culture_fit || {};
            let hasCultureFitContent = false;
            selectedAspects.forEach(key => {
                 if (cf[key] && aspects[key] && defs[key]) {
                    cultureFitHTML += `<h3>${aspects[key]}<span class="tooltip-container"><span class="tooltip-icon">i</span><span class="tooltip-text">${defs[key]}</span></span></h3>${processText(cf[key])}`;
                    hasCultureFitContent = true;
                }
            });
            if (!hasCultureFitContent) { cultureFitHTML += `<p>${t.subtitle}</p>` }
            
            const valueMatchHTML = fullReportData.value_match_score > 0 ? `<h2>${titles.value_match}</h2><div class="progress-bar-container"><div class="progress-bar" style="width: ${fullReportData.value_match_score}%;">${fullReportData.value_match_score}%</div></div>${processText(fullReportData.value_match_text)}` : '';
            const finalRiskHTML = fullReportData.final_risk_rating ? `<h2>${titles.final_risk}</h2><p><strong>${aspects.rating}: ${fullReportData.final_risk_rating}</strong></p>${processText(fullReportData.final_risk_text)}` : '';

            resultContainer.innerHTML = DOMPurify.sanitize(reportHeaderHTML + redFlagHTML + hiringExperienceHTML + timelinessHTML + cultureFitHTML + valueMatchHTML + finalRiskHTML, {ADD_TAGS: ['span', 'div', 'ul', 'li', 'strong', 'a', 'br', 'h2', 'h3', 'p', 'em', 'strong', 'b', 'i'], ADD_ATTR: ['style', 'href', 'class', 'target', 'rel']});
            
            if (Array.isArray(sourcesData) && sourcesData.length > 0) {
                let sourcesHTML = `<h2>${titles.sources}</h2>`;
                sourcesData.forEach(source => {
                    // ÁªôÊØè‰∏™ÊñáÁåÆÊù°ÁõÆÂä†‰∏äÂØπÂ∫îÁöÑ idÔºåËøôÊ†∑ÈîöÁÇπÈìæÊé•ÊâçËÉΩÊâæÂà∞ÂÆÉ
                    sourcesHTML += `<div class="source-item" id="source-${source.id}">${ICONS[source.source_type] || ICONS.default}<span>[${source.id}]</span><a href="${source.link}" target="_blank" rel="noopener noreferrer">${source.title}</a></div>`;
                });
                sourcesContainer.innerHTML = DOMPurify.sanitize(sourcesHTML, {ADD_TAGS: ['div', 'span', 'a', 'svg', 'path'], ADD_ATTR: ['id', 'href', 'target', 'rel', 'class', 'xmlns', 'width', 'height', 'fill', 'viewBox', 'd', 'fill-rule']});
            } else {
                sourcesContainer.innerHTML = '';
            }
        }
        
        // --- 7. Ê†∏ÂøÉ‰∫ã‰ª∂Â§ÑÁêÜ ---
        let loadingInterval = null;
        analyzeButton.addEventListener('click', async function() {
            const t = translations[currentLang];
            const buttonTextSpan = analyzeButton.querySelector('span');
            
            buttonTextSpan.textContent = t.button_loading_text;
            analyzeButton.insertAdjacentHTML('beforeend', '<div class="spinner"></div>');
            analyzeButton.disabled = true;
            sourcesContainer.innerHTML = '';
            fullReportData = null; companyNameData = null; sourcesData = null;

            let statusIndex = 0;
            const loadingStatuses = t.loading_statuses;
            resultContainer.innerHTML = `<p>${loadingStatuses[statusIndex++]}</p>`;
            loadingInterval = setInterval(() => {
                if (statusIndex < loadingStatuses.length) {
                    resultContainer.innerHTML = `<p>${loadingStatuses[statusIndex++]}</p>`;
                } else { clearInterval(loadingInterval); }
            }, 2500);

            try {
                const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ companyName: smartPasteBox.value, resumeText: resumeTextInput.value, language: currentLang }) });
                
                const responseText = await response.text(); 
                clearInterval(loadingInterval);

                let result;
                try {
                    result = JSON.parse(responseText); 
                } catch (e) {
                    result = { error: 'parse_error', message: responseText };
                }

                if (response.ok) {
                    fullReportData = result.report;
                    companyNameData = result.company_name;
                    sourcesData = result.sources;
                    renderReport();
                } else {
                    let errorMessage = t.generic_error; // Default to a generic error message.
                    if (response.status === 429) {
                        errorMessage = t.rate_limit_exceeded;
                    } else if (response.status === 404) {
                        errorMessage = t.no_info_found;
                    }
                    // If the backend provides a more specific message in the JSON response, use that instead.
                    if (result.message) {
                        errorMessage = result.message;
                    }
                    resultContainer.innerHTML = `<h2 style="color: var(--danger-color);">Error (Code: ${response.status})</h2><p style="white-space: pre-wrap;">${errorMessage}</p>`;
                }
            } catch (error) {
                clearInterval(loadingInterval);
                resultContainer.innerHTML = `<h2>Error</h2><p>${t.connection_error}</p>`;
            } finally {
                clearInterval(loadingInterval);
                buttonTextSpan.textContent = t.button_text;
                if(analyzeButton.querySelector('.spinner')) analyzeButton.querySelector('.spinner').remove();
                analyzeButton.disabled = false;
            }
        });

        // --- 8. ÂàùÂßãÂåñÂíå‰∫ã‰ª∂ÁõëÂê¨ ---
        themeSwitcher.addEventListener('click', () => setTheme(document.documentElement.classList.contains('light-mode') ? 'dark' : 'light'));
        langToggle.addEventListener('click', (e) => { if (e.target.tagName==='BUTTON') { setLanguage(e.target.dataset.lang); renderReport(); } });
        aspectTagsContainer.addEventListener('change', () => { if (fullReportData) { renderReport(); } });
        setTheme(localStorage.getItem('theme') || 'dark');
        setLanguage('zh-CN');
    </script>
</body>
</html>